<%- include ('../partials/header', {signInUrl: signInUrl, signOutUrl: signOutUrl}) -%>

<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="<%=homeURL%>">Home</a></li>
        <% for( let index = 0; index < breadcrumb.length; index++ ) { %>

        <% if (index == breadcrumb.length -1) { %>
        <li class="breadcrumb-item active" aria-current="page"><%= breadcrumb[index].name %></li>
        <% }else { %>
        <li class="breadcrumb-item">
            <a href="<%= breadcrumb[index].url %>">
                <%= breadcrumb[index].name %>
            </a>
        </li>
        <% } %>

        <% } %>
    </ol>
</nav>
<div class="container-fluid">
    <h2>Create Evaluation Rubric</h2>
    <hr class="my-4">

    <form id="<%= form_id %>" action="<%= url_form_redirect %>" method="POST">

        <div class="container-fluid">
            <div class="row my-4">
                <div class="col-2 align-self-center text-right"><strong>Study Programs</strong></div>
                <div class="col-8">
                    <select id="study_program" type="text" name="study_program" required>
                        <option disabled selected value> -- Select Study Program -- </option>
                        <% for (let std of std_options) {%>
                        <option class="dropdown-item" value="<%=std.ID%>"> <%= std.NAME%> </option>
                        <% } %>
                    </select>
                </div>
            </div>
        </div>

        <div class="container-fluid">
            <div class="row my-4">
                <div class="col-2 align-self-center text-right"><strong>Outcomes</strong></div>
                <div class="col-8 ">
                    <select id="outcomes" type="text" name="outcome" required>
                        <option disabled selected value> -- Select Outcome -- </option>
                    </select>
                </div>
            </div>
        </div>

        <div class="row my-4">
            <div class="col-2 align-self-center text-right"><strong>Performance Criteria</strong></div>
            <div id="multi_selection" class="col-8">
                <span class="multi-select"></span>
                <span class="multi-select2"></span>
            </div>
            <input id="multiple_performance" type="hidden" name="performances_id" value="">

        </div>

        <% inputs.forEach(element => { %>

        <div class="row my-4">
            <div class="col-2 align-self-center text-right"><strong><%= element.title %> </strong></div>
            <div class="col-8">
                <input class="form-control" value="<%= element.value %>" type="text"
                    placeholder="<%= element.placeHolder %>" name="<%= element.name %>">
            </div>
        </div>
        <% }) %>

        <% if (description_box != undefined) { %>
	
			<div class="row my-4">
				<div class="col-2 align-self-center text-right"><strong>Description</strong></div>
				<div class="col-8">
					<textarea class="form-control" name="<%= description_box["name"]%>" rows="4"
					placeholder="<%=description_box["text"]%>"><%= description_box["value"]%></textarea>
				</div>
			</div>
		<% } %>

        <div class="row my-4">
            <div class="col-2"></div>
            <div class="col"><button type="submit" class="btn btn-outline-secondary"><%= btn_title %></button></div>
        </div>
        <p><a href="<%= base_url %> ">Back to List</a></p>
    </form>
</div>


<script>
    $(document).ready(() => {

        var multi = new SelectPure(".multi-select2", {
            options: [],
            value: [],
            multiple: true,
            icon: "fa fa-times",
            placeholder: "-- Please Select --",
            onChange: value => { },
            classNames: {
                select: "select-pure__select",
                dropdownShown: "select-pure__select--opened",
                multiselect: "select-pure__select--multiple",
                label: "select-pure__label",
                placeholder: "select-pure__placeholder",
                dropdown: "select-pure__options",
                option: "select-pure__option",
                selectedLabel: "select-pure__selected-label",
                selectedOption: "select-pure__option--selected",
                placeholderHidden: "select-pure__placeholder--hidden",
                optionHidden: "select-pure__option--hidden",
            }
        });

        // change the data when user select study program
        $("#study_program").change(function () {

            // clean outcomes data
            $('#outcomes').empty().append('<option disabled selected value> -- Select Outcome -- </option>');

            // get the selected id of the study program to make the request
            var study_program_id = $(this).children("option:selected").val();

            $.ajax({
                'url': `/admin/outcomes/${study_program_id}/getStudyProgram`,
                type: 'GET',
                dataType: 'json',
                beforeSend: function () {
                    // Show image container
                    $("#loader").show();
                    $('#outcomes').prop("disabled", true);
                },
                success: (data) => {

                    // populate the options
                    data.forEach(element => {
                        $('#outcomes').append(`<option value='${element.outc_ID}'>${element.outc_name}</option>`);
                    });
                }, complete: function (data) {
                    // Hide image container
                    $("#loader").hide();
                    $('#outcomes').prop("disabled", false);

                }
            });
        });

        // add performance Rubric

        // change the data when user select study program
        $("#outcomes").change(function () {

            mult = [];

            // clean outcomes data
            $('#performance').empty().append('<option disabled selected value> -- Select Performance Criteria -- </option>');

            // get the selected id of the outcome to make the request
            var outcome_id = $(this).children("option:selected").val();
            console.log("selected: ", outcome_id);

            $.ajax({
                'url': `/admin/outcomes/get/performances/${outcome_id}`,
                type: 'GET',
                dataType: 'json',
                beforeSend: function () {
                    // Show image container
                    $("#loader").show();
                },
                complete: function (data) {
                    // Hide image container
                    $("#loader").hide();
                },
                success: (data) => {

                    $(".multi-select2").remove();
                    $("#multi_selection").empty();
                    $("#multi_selection").append(`<span class="multi-select"></span>`);

                    let mult_values = [];
                    // populate the options
                    data.forEach(element => {
                        mult_values.push({ label: element.name, value: element.value.toString() })
                    });

                    var multi = new SelectPure(".multi-select", {
                        options: mult_values,
                        value: [],
                        multiple: true,
                        icon: "fa fa-times",
                        placeholder: "-- Please Select --",
                        onChange: value => {
                            console.log(value);
                            $("#multiple_performance").attr("value", value)
                        },
                        classNames: {
                            select: "select-pure__select",
                            dropdownShown: "select-pure__select--opened",
                            multiselect: "select-pure__select--multiple",
                            label: "select-pure__label",
                            placeholder: "select-pure__placeholder",
                            dropdown: "select-pure__options",
                            option: "select-pure__option",
                            selectedLabel: "select-pure__selected-label",
                            selectedOption: "select-pure__option--selected",
                            placeholderHidden: "select-pure__placeholder--hidden",
                            optionHidden: "select-pure__option--hidden",
                        }
                    });
                }
            });
        });
    });
</script>

<link rel="stylesheet" type="text/css" href="/stylesheets/multiselect.css">
<%- include ('../partials/footer') -%>